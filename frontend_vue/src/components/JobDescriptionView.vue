<template>
  <div>
    <p
      v-for='(line, idx) in finalDescription'
      :key='idx'
    >
      <span v-html='line' />
    </p>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';

onMounted(() => {
  parseText();
});

const props = defineProps({
  description: String,
});

const finalDescription = ref(['']);

const parseText = () => {
  let splitDescription = props.description?.split('\n');

  let listFlag = false;
  for (let lineIndex in splitDescription) {
    let line = splitDescription[Number(lineIndex)];
    // apply italics
    line = line.replace(/_(\s+)_/g, (match: string, italicContent: string) => `<i>${italicContent}</i>`);
    if (line.startsWith('- ')) {
      // remove that hyphen when rendering
      line = line.replace(/^- ?/, '');
      if (!listFlag) {
        listFlag = true;
        finalDescription.value.push('<ul>');
      }
      finalDescription.value.push(`<li>${line}</li>`);
    } else if (/^#/.test(line)) {
      finalDescription.value.push(`<h3>${line}</h3>`);
    } else {
      if (listFlag) {
        listFlag = false;
        finalDescription.value.push('</ul>');
      }
      finalDescription.value.push(line);
    }
  }
};
</script>

<style scoped lang="scss">
p, span {
  color: $black;
}
</style>
